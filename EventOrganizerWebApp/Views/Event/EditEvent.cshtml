@model EventOrganizerWebApp.EventModel

@{
    ViewBag.Title = "EditEventAction";
}

<h2>EditEvent</h2>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">

    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/scripts/jquery-3.3.1.min.js"></script>
    <script src="~/scripts/bootstrap.min.js"></script>
    <link href="~/Content/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <script src="~/scripts/jquery.dataTables.min.js"></script>
    <script src="~/scripts/dataTables.bootstrap4.min.js"></script>

</head>

<style>
    #SearchNavBar, #SearchItemsContainer {
        display: none;
    }
</style>

<body>
    <nav class="navbar navbar-light bg-faded">
        <div id="SearchNavBar">
            <form class="form-inline float-lg-left">
                <button class="btn btn-outline-success" id="CloseAddFriendsButton">Close</button>
                <input class="form-control" type="text" id="SearchBar" placeholder="Search" />
            </form>
        </div>

        <div id="DefaultNavBar">
            <button class="navbar-toggler hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"></button>
            <div class="collapse navbar-toggleable-md" id="navbarResponsive">
                <a class="navbar-brand" href="#">Navbar</a>
                @*<ul class="nav navbar-nav">
                        <li class="nav-item active">
                            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Link</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Link</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="http://example.com" id="responsiveNavbarDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                            <div class="dropdown-menu" aria-labelledby="responsiveNavbarDropdown">
                                <a class="dropdown-item" href="#">Action</a>
                                <a class="dropdown-item" href="#">Another action</a>
                                <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                        </li>
                    </ul>*@
                <form class="form-inline float-lg-right">
                    <button class="btn btn-outline-success" id="AddFriendsButton">Adauga persoane la eveniment</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container-fluid" id="SearchItemsContainer">
        <div class="row">
            <div class="col-xs-4" id="SearchItems">
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>

</body>

<div class="container py-4">
    <h4 class="text-center text-uppercase">Participanti</h4>
    <div id="dataTable_wrapper2"></div>
    <table id="dataTable2" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>User Email</th>
                <th>Status</th>
            </tr>
        </thead>
    </table>
</div>


@using (Html.BeginForm("EditEventAction", "Event"))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>EventModel</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            @Html.LabelFor(model => model.EventName, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.EventName, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.EventName, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.EventDescription, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.EventDescription, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.EventDescription, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.StartDate, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.StartDate, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.StartDate, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.EndDate, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.EndDate, new { htmlAttributes = new { @class = "form-control" } })
                @Html.ValidationMessageFor(model => model.EndDate, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Save" class="btn btn-default" />
            </div>
        </div>
    </div>
}

<div class="form-group">
    <div class="col-md-offset-0 col-md-50">
        <input type="button" value="Adauga task-uri" class="btn btn-default" onclick="location.href='@Url.Action("AddTask", "Task")'" />
    </div>
</div>

<div class="container py-4">
    <h4 class="text-center text-uppercase">Participanti</h4>
    <div id="dataTable_wrapper2"></div>
    <table id="dataTable3" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Task Name</th>
                <th>Task Description</th>
                <th>Deadline</th>
            </tr>
        </thead>
    </table>
</div>


<nav class="navbar navbar-light bg-faded">
    <div id="SearchNavBar2">
        <form class="form-inline float-lg-left">
            @*<button class="btn btn-outline-success" id="CloseSearch_distr">Close</button>*@
            <input class="form-control" type="text" id="SearchBar_distr" placeholder="Search" />
        </form>
    </div>

    <div id="DefaultNavBar">
        <button class="navbar-toggler hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"></button>
        <div class="collapse navbar-toggleable-md" id="navbarResponsive">
            <a class="navbar-brand" href="#">Navbar</a>
            <form class="form-inline float-lg-right">
                @*<button class="btn btn-outline-success" id="AddFriendsButton">Adauga prieteni</button>*@
            </form>
        </div>
    </div>
</nav>

<div class="container-fluid" id="SearchItemsContainer2">
    <div class="row">
        <div class="col-xs-4" id="SearchItems2">
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>


<div>
    @*@Html.ActionLink("Back to Home", "~/Views/Home/UserPage")*@
</div>

<style>
    #SearchNavBar2, #SearchItemsContainer2 {
        display: none;
    }
</style>

@section Scripts {
    @Scripts.Render("~/bundles/jquery")

    <script type="text/javascript">

        var user = { id: "", firstName: "", lastName: "", emailAddress: "", phoneNr: "" };

        var emailList = [];

        $(document).ready(function () {

            $.ajax({
                type: "POST",
                url: "/Home/GetUsersData",
                dataType: "json",
                success: function (json) {
                    for (var i = 0; i < json.length; i++) {
                        emailList.push(json[i].EmailAddress);
                    }
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });

            $("#SearchBar_distr").keyup(function () {
                console.log("keyup");
                $("#SearchItems2").empty();

                for (var i = 0; i < emailList.length; i++) {
                    if (emailList[i].toLowerCase().includes($("#SearchBar_distr").val().toLowerCase().trim())
                        && $("#SearchBar_distr").val().trim().length > 0) {
                        $("#SearchItems2").append("<a class='assignTask' id=" + emailList[i] + " href='javascript:alert(&quot; Task assigned to user! &quot;);'>" + emailList[i] + "</a>");
                    }
                }
            });
        });


        $(document).on('click', '.distribuie', function () {

            function ToggleSearch(event) {
                event.preventDefault();

               // $("#DefaultNavBar").toggle();
                $("#SearchNavBar2").toggle();

                $("#SearchItemsContainer2").toggle();
            }
            ToggleSearch(event);

            var $rowID = $(this).closest('tr').find('.TaskName').text();

            option = {
                url: "/Task/EditTask",
                dataType: "json",
                type: "POST",
                //contentType: 'application/json',
                data: { "taskname": $rowID.toString() },
                success: function (data) {
                    // alert(data);
                },
                failure: function (errMsg) {
                    alert(errMsg);
                }
            };

            $.ajax(option);

         });

        $(document).on('click', '.assignTask', function (event) {

            if (confirm("Are you sure?")) {

                option = {
                    url: "/Task/assignTask",
                    dataType: "text",
                    type: "POST",
                    data: { "adr": event.target.id },
                    success: function () {
                        window.location.href = "EditEvent";
                    },
                    failure: function (errMsg) {
                        alert(errMsg);
                    }
                };

                $.ajax(option);
            }
        });



        $(document).ready(function () {

            function ToggleSearch(event) {
                event.preventDefault();

                $("#DefaultNavBar").toggle();
                $("#SearchNavBar").toggle();

                $("#SearchItemsContainer").toggle();
            }

            $("#AddFriendsButton").click(function (event) {

                $.ajax({
                    type: "POST",
                    url: "/Home/GetUsersData",
                    dataType: "json",
                    success: function (json) {
                        for (var i = 0; i < json.length; i++) {
                            emailList.push(json[i].EmailAddress);
                        }
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                });
                ToggleSearch(event);
            });

            $("#CloseAddFriendsButton").click(function (event) {
                ToggleSearch(event);
            });

            $("#SearchBar").keyup(function () {
                $("#SearchItems").empty();

                for (var i = 0; i < emailList.length; i++) {
                    if (emailList[i].toLowerCase().includes($("#SearchBar").val().toLowerCase().trim())
                        && $("#SearchBar").val().trim().length > 0) {
                        $("#SearchItems").append("<a class='inviteButton' id=" + emailList[i] + " href='javascript:alert(&quot; User Invited to Event! &quot;);'>" + emailList[i] + "</a>");
                    }
                }
            });

            $(document).on('click', '.inviteButton', function (event) {

                if (confirm("Are you sure?")) {

                    //var $rowID = $(this).closest('tr').find('.Id').text();

                    option = {
                        url: "/Event/inviteUser",
                        dataType: "text",
                        type: "POST",
                        data: { "adr": event.target.id },
                        success: function () {
                            window.location.href = "EditEvent";
                        },
                        failure: function (errMsg) {
                            alert(errMsg);
                        }
                    };

                    $.ajax(option);
                }
            });

        });

        $(function () {
            $(document).ready(function () {
                $.ajax({
                    type: "POST",
                    url: "/Event/GetParticipants",
                    dataType: "json",
                    success: function (json) {
                        var tr;

                        //Append each row to html table
                        for (var i = 0; i < json.length; i++) {
                            tr = $('<tr class="Participanti"/>');
                            console.log(JSON.stringify(json[i]));
                            tr.append('<td class="Participanti">' + json[i].UserEmail + '</td>');
                            //tr.append('<td class="Participanti">' + json[i].EventID + '</td>');
                            tr.append("<td>" + json[i].InviteStatus + "</td>");
                            tr.append('<td> <form action="/Event/acceptInv" method="POST"> <button class="acceptInv" type="submit">Kick</button> </form> <button class="refuseInv" type="button">Send message</button> </td>');
                            $('#dataTable2').append(tr);
                        }
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                });
            });
        });

        function FormatJSONDate(str) {
            var year, month, day, hour, minute, d, finalDate;

            str = str.replace(/\D/g, "");
            d = new Date(parseInt(str));

            year = d.getFullYear();
            month = pad(d.getMonth() + 1);
            day = pad(d.getDate());
            hour = pad(d.getHours());
            minutes = pad(d.getMinutes());

            finalDate = year + "-" + month + "-" + day + " " + hour + ":" + minutes;

            function pad(num) {
                num = "0" + num;
                return num.slice(-2);
            }

            return finalDate;

        };

        $(document).on('click', '.getName', function () {
            var $rowID = $(this).closest('tr').find('.TaskName').text();

            option = {
                url: "/Task/EditTask",
                dataType: "json",
                type: "POST",
                //contentType: 'application/json',
                data: { "taskname": $rowID.toString() },
                success: function (data) {
                    // alert(data);
                },
                failure: function (errMsg) {
                    alert(errMsg);
                }
            };

            $.ajax(option);

        });

        $(function () {
            $(document).ready(function () {
                $.ajax({
                    type: "POST",
                    url: "/Task/GetTasksData",
                    dataType: "json",
                    success: function (json) {
                        var tr;

                        //Append each row to html table
                        for (var i = 0; i < json.length; i++) {
                            tr = $('<tr class="TaskName"/>');
                            console.log(JSON.stringify(json[i]));
                            //tr.append('<td class="Id">' + json[i].Id + '</td>');
                            tr.append('<td class="TaskName">' + json[i].TaskName + '</td>');
                            tr.append("<td>" + json[i].TaskDescription + "</td>");
                            tr.append("<td>" + FormatJSONDate(json[i].Deadline) + "</td>");
                            tr.append('<td> <button class="distribuie" type="submit">Distribuie</button> </form> <button class="deleteTask" type="button">Delete</button> </td>');
                            $('#dataTable3').append(tr);
                        }
                    },
                    failure: function (response) {
                        alert(response.responseText);
                    },
                    error: function (response) {
                        alert(response.responseText);
                    }
                });
            });
        });



    </script>
}